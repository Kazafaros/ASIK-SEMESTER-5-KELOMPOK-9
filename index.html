<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MarineEcoPredict - Predicting the Future of Our Oceans</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="css/styles.css" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#0077b6",
            "secondary": "#00b4d8",
            "light-accent": "#caf0f8",
            "background-light": "#f6f8f8",
            "background-dark": "#101d22",
            "text-light": "#111618",
            "text-dark": "#f0f8ff",
            "text-muted-light": "#617f89",
            "text-muted-dark": "#94a3b8"
          },
          fontFamily: {
            "sans": ["Poppins", "sans-serif"]
          },
          borderRadius: {"DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px"},
        },
      },
    }
  </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-sans text-text-light dark:text-text-dark" data-page="index">
  <div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">
    <header class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-lg">
      <div class="container mx-auto px-4">
        <div class="flex h-16 items-center gap-4 border-b border-black/10 dark:border-white/10">
          <a href="index.html" class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-waves text-primary h-6 w-6" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path></svg>
            <span class="text-lg font-bold text-text-light dark:text-text-dark">MarineEcoPredict</span>
          </a>
          <nav id="mobileMenu" class="hidden absolute top-16 left-0 right-0 bg-background-light dark:bg-background-dark border-b border-black/10 dark:border-white/10 lg:static lg:flex lg:items-center lg:gap-6 site-nav lg:border-0 flex-col lg:flex-row lg:bg-transparent lg:dark:bg-transparent p-4 lg:p-0">
            <a href="index.html" data-nav="index" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Beranda</a>
            <a href="analysis.html" data-nav="analysis" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Analisis</a>
            <a href="comparison.html" data-nav="comparison" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Perbandingan</a>
            <a href="history.html" data-nav="history" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Riwayat</a>
            <a href="biogeography.html" data-nav="biogeography" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Biogeografi</a>
            <a href="help.html" data-nav="help" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Bantuan</a>
            <a href="about.html" data-nav="about" data-nav-link class="text-sm font-medium site-nav-link py-3 lg:py-0 px-2 lg:px-0 hover:bg-black/5 dark:hover:bg-white/5 lg:hover:bg-transparent lg:dark:hover:bg-transparent rounded">Tentang</a>
          </nav>
          <div class="ml-auto flex items-center gap-2">
            <button type="button" data-theme-toggle aria-pressed="false" aria-label="Aktifkan mode gelap" class="flex size-10 items-center justify-center rounded-full border border-black/10 bg-white/70 text-text-muted-light transition hover:bg-white dark:border-white/10 dark:bg-background-dark/80 dark:text-text-muted-dark">
              <span class="sr-only">Toggle theme</span>
              <span data-theme-icon="sun" class="hidden">
                <i data-lucide="sun" class="size-5"></i>
              </span>
              <span data-theme-icon="moon">
                <i data-lucide="moon" class="size-5"></i>
              </span>
            </button>
            <button id="menuToggle" class="flex items-center justify-center rounded-md p-2 lg:hidden text-text-light dark:text-text-dark hover:bg-white/10 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-menu h-6 w-6" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg>
              <span class="sr-only">Open menu</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-grow">
      <div class="@container">
        <div class="@[480px]:p-4">
          <div class="flex min-h-[480px] flex-col gap-6 bg-cover bg-center bg-no-repeat @[480px]:gap-8 @[480px]:rounded-lg items-center justify-center p-4 text-center" style='background-image: linear-gradient(rgba(16, 29, 34, 0.4) 0%, rgba(16, 29, 34, 0.7) 100%), url("https://lh3.googleusercontent.com/aida-public/AB6AXuCvUXhhipGWQ0dKvxbyuNCwSs9pa7eq1jp6ntCRtgVl0gxQh8lsafPJAvF3D--9er6Q4BWKeP3vwXF-HC5nIPUs-QvonnxsVasrOR_qiGobKN_rY8ECQ48DJ_Tnx4pd-hZ3W65W8ckqyZ_8Ba3z9Cf-mP5jMxTZeyjaXLmc8b93SNDrdHoTlYX9ORTUgIFmHj9uit4mCG65PVLVq_ddNTdY2Ku2A7ZO7edXumg22bPnNGVuSge-6ZR58Aq1pYrwwqhSyQF9W_pOolgt");'>
            <div class="flex flex-col gap-2">
              <h1 class="text-white text-4xl font-bold leading-tight tracking-tight @[480px]:text-5xl @[480px]:leading-tight">
                Memprediksi Masa Depan Lautan Kita
              </h1>
              <h2 class="text-white/90 text-base font-normal leading-normal @[480px]:text-lg max-w-lg mx-auto">
                Memperkirakan kesehatan ekosistem laut dengan pemodelan prediktif dan analisis data real-time.
              </h2>
            </div>
            <a href="analysis.html" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 @[480px]:h-12 @[480px]:px-5 bg-primary text-white text-sm font-semibold leading-normal @[480px]:text-base hover:bg-opacity-90 transition-colors">
              <span class="truncate">Mulai Prediksi</span>
            </a>
          </div>
        </div>
      </div>

      <div class="container mx-auto px-4 pt-8">
        <div class="flex flex-col gap-4">
          <h2 class="text-text-light dark:text-text-dark text-2xl font-bold leading-tight tracking-tight">Analisis Data Historis di Selat Sunda</h2>
          
          <!-- Map Controls -->
          <div class="mb-4 flex flex-wrap gap-3 items-center justify-between bg-white dark:bg-background-dark p-4 rounded-lg border border-black/10 dark:border-white/10">
            <div class="flex flex-wrap gap-3 items-center">
              <div class="flex items-center gap-2">
                <label class="text-sm font-medium muted">Parameter:</label>
                <select id="layer-select" class="form-control">
                  <option value="hsi">HSI</option>
                  <option value="sst">SST</option>
                  <option value="chlor_a">Chlorophyll-a</option>
                  <option value="salinity">Salinity</option>
                </select>
              </div>
              <div class="flex items-center gap-2">
                <label class="text-sm font-medium muted">Warna Peta:</label>
                <select id="colormap-select" class="form-control">
                  <option value="viridis">Viridis</option>
                  <option value="plasma">Plasma</option>
                  <option value="inferno">Inferno</option>
                  <option value="magma">Magma</option>
                  <option value="turbo">Turbo</option>
                  <option value="jet">Jet</option>
                </select>
              </div>
              <div class="flex items-center gap-2">
                <label class="text-sm font-medium muted">Tahun:</label>
                <select id="year-select" class="form-control">
                  <option value="2021">2021</option>
                  <option value="2022">2022</option>
                  <option value="2023">2023</option>
                  <option value="2024">2024</option>
                </select>
              </div>
              <div class="flex items-center gap-2">
                <label class="text-sm font-medium muted">Bulan:</label>
                <select id="month-select" class="form-control">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
            </div>
            
            <!-- Download Button - Outside Map -->
            <div class="relative">
              <button id="download-data-btn" class="flex items-center gap-2 rounded-lg bg-primary px-4 py-2 text-white text-sm font-semibold transition hover:bg-primary/90 shadow-lg">
                <i data-lucide="download" class="size-4"></i>
                <span>Unduh Data</span>
              </button>
              <div id="download-dropdown" class="hidden absolute top-full right-0 mt-2 bg-white dark:bg-background-dark rounded-lg border border-black/10 dark:border-white/10 shadow-xl min-w-[220px] overflow-hidden z-50">
                <button onclick="downloadClickedData()" class="w-full text-left px-4 py-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2">
                  <i data-lucide="mouse-pointer-click" class="size-4"></i>
                  <span>Data yang Diklik</span>
                </button>
                <button onclick="downloadAllHistoricalData()" class="w-full text-left px-4 py-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-800 transition flex items-center gap-2 border-t border-black/10 dark:border-white/10">
                  <i data-lucide="database" class="size-4"></i>
                  <span>Data Historis Lengkap</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Map Container -->
          <div class="index-map-container">
            <div id="sunda-strait-map" class="w-full h-full"></div>
            
            <!-- Map Interaction Info -->
            <div class="legend-box absolute bottom-4 left-4 z-[999] text-xs">
              ðŸ’¡ Klik pada peta untuk melihat detail data di dashboard
            </div>
            
            <!-- Legend -->
            <div class="legend-box absolute top-4 right-4 z-[1000] min-w-[160px] max-w-[220px] md:min-w-[180px] md:max-w-[240px]">
              <h3 class="text-xs font-bold mb-2 md:text-sm" id="legend-title">HSI Legend</h3>
              <div id="legend-content">
                <!-- Gradient legend will be generated here -->
                <div class="flex flex-col space-y-2">
                  <div class="relative h-20 md:h-32 w-full rounded" id="legend-gradient"></div>
                  <div class="flex justify-between text-xs muted">
                    <span id="legend-min">0.0</span>
                    <span id="legend-max">1.0</span>
                  </div>
                  <div class="text-xs muted mt-1" id="legend-unit">(Index 0-1)</div>
                  <!-- Interpretation guide -->
                  <div class="border-t border-black/10 dark:border-white/10 pt-2 mt-2" id="legend-interpretation">
                    <div class="text-xs font-semibold mb-1.5">Interpretasi:</div>
                    <div class="space-y-1 text-xs" id="legend-categories"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- OLAP Dashboard Below Map -->
      <div class="container mx-auto px-4 pt-6">
        <div class="card">
          <h3 class="text-primary text-xl font-bold leading-tight mb-4">Dashboard Analisis OLAP</h3>
          
          <!-- OLAP Controls -->
          <div class="mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3">
            <div>
              <label class="block text-xs font-bold mb-2">Dimensi Waktu</label>
              <select id="olap-time-dimension" class="w-full form-control">
                <option value="monthly">Bulanan</option>
                <option value="yearly">Tahunan</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-bold mb-2">Pilih Parameter</label>
              <select id="olap-layer-select" class="w-full form-control">
                <option value="hsi">Habitat Suitability Index (HSI)</option>
                <option value="sst">Suhu Permukaan Laut (SST)</option>
                <option value="chlor_a">Klorofil-a</option>
                <option value="salinity">Salinitas</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-bold mb-2">Agregasi</label>
              <select id="olap-aggregation" class="w-full form-control">
                <option value="mean">Rata-rata</option>
                <option value="min">Minimum</option>
                <option value="max">Maksimum</option>
                <option value="std">Standart Deviasi</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-bold mb-2">Jenis Visualisasi</label>
              <select id="olap-visualization" class="w-full form-control">
                <option value="overview">Overview</option>
                <option value="timeseries">Time Series</option>
                <option value="comparison">Perbandingan Parameter</option>
                <option value="statistics">Statistik</option>
              </select>
            </div>
          </div>
          
          <!-- OLAP Content Area -->
          <div id="olap-dashboard-content" class="min-h-[300px] bg-background-light dark:bg-gray-800/50 rounded-lg p-6 border border-black/10 dark:border-white/10">
            <div class="flex items-center justify-center h-full text-text-muted-light dark:text-text-muted-dark">
              <p>Pilih lokasi pada peta untuk memulai analisis OLAP...</p>
            </div>
          </div>
        </div>
      </div>

      <div class="container mx-auto p-4">
        <div class="card">
          <h3 class="text-primary text-xl font-bold leading-tight mb-2">Kesesuaian Habitat & Daya Dukung</h3>
          <p class="text-text-muted-light dark:text-text-muted-dark text-sm leading-relaxed mb-4">
            Habitat Suitability Index (HSI) adalah alat penting untuk mengevaluasi kualitas habitat yang ada di laut. Dengan memprediksi daya dukung ekosistem laut, kita dapat memastikan keberlanjutan sumber daya dalam mengelola aktivitas perikanan secara efektif dan melindungi keanekaragaman hayati dari dampak perubahan iklim dan aktivitas manusia.
          </p>
          <a href="help.html" class="flex w-full min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-secondary/10 text-secondary text-sm font-semibold leading-normal hover:bg-secondary/20 transition-colors">
            <span class="truncate">Pelajari Lebih Lanjut</span>
          </a>
        </div>
      </div>

      <div class="container mx-auto px-4 pb-3 pt-8">
        <h2 class="text-text-light dark:text-text-dark text-2xl font-bold leading-tight tracking-tight">Fitur Utama</h2>
      </div>

      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="card flex flex-col gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-line-chart h-8 w-8 text-primary" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m19 9-5 5-4-4-3 3"></path></svg>
            <div class="flex flex-col gap-1">
              <h3 class="text-text-light dark:text-text-dark text-base font-semibold leading-tight">Analisis Data Real-Time</h3>
              <p class="text-text-muted-light dark:text-text-muted-dark text-sm font-normal leading-normal">Proses data laut secara real-time dari berbagai sumber untuk memberikan wawasan ekologis yang aktual dan akurat.</p>
            </div>
          </div>
          <div class="card flex flex-col gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-bot h-8 w-8 text-primary" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>
            <div class="flex flex-col gap-1">
              <h3 class="text-text-light dark:text-text-dark text-base font-semibold leading-tight">Pemodelan Prediktif</h3>
              <p class="text-text-muted-light dark:text-text-muted-dark text-sm font-normal leading-normal">Memanfaatkan algoritma regresi dari machine learning untuk memprediksi perubahan ekosistem di tahun berikutnya.</p>
            </div>
          </div>
          <div class="card flex flex-col gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-shield-check h-8 w-8 text-primary" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path><path d="m9 12 2 2 4-4"></path></svg>
            <div class="flex flex-col gap-1">
              <h3 class="text-text-light dark:text-text-dark text-base font-semibold leading-tight">Indeks Kesehatan Ekosistem</h3>
              <p class="text-text-muted-light dark:text-text-muted-dark text-sm font-normal leading-normal">Sistem penilaian untuk interpretasi dan monitoring kesehatan lingkungan laut.</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="w-full mt-16 bg-white dark:bg-gray-900 border-t border-black/10 dark:border-white/10">
      <div class="container mx-auto max-w-screen-xl p-4 py-6 lg:py-8">
        <div class="text-center mb-8">
          <a href="index.html" class="flex items-center justify-center gap-2 mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="lucide lucide-waves text-primary h-8 w-8" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"></path></svg>
            <span class="text-2xl font-semibold text-text-light dark:text-white">MarineEcoPredict</span>
          </a>
          <p class="text-sm text-text-muted-light dark:text-text-muted-dark">Memprediksi masa depan lautan kami melalui analisis ekosistem laut tingkat lanjut.</p>
        </div>
        <div class="flex justify-center mb-8">
          <div class="grid grid-cols-2 gap-12 sm:gap-20">
            <div class="text-center">
              <h2 class="mb-4 text-sm font-semibold text-gray-900 uppercase dark:text-white">Sumber Daya</h2>
              <ul class="text-text-muted-light dark:text-text-muted-dark font-medium">
                <li><a href="help.html" class="hover:underline">Dokumentasi</a></li>
              </ul>
            </div>
            <div class="text-center">
              <h2 class="mb-4 text-sm font-semibold text-gray-900 uppercase dark:text-white">Ikuti Kami</h2>
              <ul class="text-text-muted-light dark:text-text-muted-dark font-medium">
                <li><a href="https://github.com/faiqmuammar4" class="hover:underline">Github</a></li>
              </ul>
            </div>
          </div>
        </div>
        <hr class="my-6 border-gray-200 sm:mx-auto dark:border-gray-700 lg:my-8" />
        <div class="text-center">
          <span class="text-sm text-text-muted-light dark:text-text-muted-dark">Â© 2024 MarineEcoPredictâ„¢. All Rights Reserved.</span>
        </div>
      </div>
    </footer>
  </div>
  <script>
    // Mobile menu toggle
    (function () {
      const menuToggle = document.getElementById('menuToggle');
      const mobileMenu = document.getElementById('mobileMenu');
      
      if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
        
        // Close menu when clicking on a link
        const menuLinks = mobileMenu.querySelectorAll('a');
        menuLinks.forEach(link => {
          link.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
          });
        });
      }
    })();

    (function () {
      const root = document.documentElement;
      const toggleBtn = document.querySelector('[data-theme-toggle]');
      const sunWrapper = toggleBtn?.querySelector('[data-theme-icon="sun"]');
      const moonWrapper = toggleBtn?.querySelector('[data-theme-icon="moon"]');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
      const storedTheme = localStorage.getItem('theme');

      const initialDark = storedTheme ? storedTheme === 'dark' : prefersDark?.matches;
      applyTheme(initialDark);

      toggleBtn?.addEventListener('click', () => {
        const nextIsDark = !root.classList.contains('dark');
        applyTheme(nextIsDark);
        localStorage.setItem('theme', nextIsDark ? 'dark' : 'light');
      });

      prefersDark?.addEventListener?.('change', (event) => {
        if (!localStorage.getItem('theme')) {
          applyTheme(event.matches);
        }
      });

      function applyTheme(isDark) {
        root.classList.toggle('dark', isDark);
        toggleBtn?.setAttribute('aria-pressed', String(isDark));
        toggleBtn?.setAttribute('aria-label', isDark ? 'Aktifkan mode terang' : 'Aktifkan mode gelap');
        if (isDark) {
          sunWrapper?.classList.remove('hidden');
          moonWrapper?.classList.add('hidden');
        } else {
          sunWrapper?.classList.add('hidden');
          moonWrapper?.classList.remove('hidden');
        }
      }
    })();

    (function () {
      const currentPage = document.body.dataset.page;
      if (!currentPage) return;
      document.querySelectorAll('[data-nav-link]').forEach((link) => {
        if (link.dataset.nav === currentPage) {
          link.classList.add('nav-link-active');
          link.setAttribute('aria-current', 'page');
        } else {
          link.classList.remove('nav-link-active');
          link.removeAttribute('aria-current');
        }
      });
    })();

    lucide.createIcons();
  </script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/map.js"></script>
  <script src="js/olap-dashboard.js"></script>
  <script src="js/index-interactive.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <script src="js/data-export.js"></script>
  <script>
    // Initialize map and controls for historical analysis
    document.addEventListener('DOMContentLoaded', async () => {
      const mapContainer = document.getElementById('sunda-strait-map');
      if (!mapContainer) return;

      const apiClient = new HSIApiClient();
      const mapManager = new HSIMapManager('sunda-strait-map', {
        defaultLayer: 'hsi',
        defaultColormap: 'viridis'
      });

      window.sundaStraitMap = mapManager;

      // Load available data and set default year-month
      try {
        const available = await apiClient.getAvailableData();
        if (available.available && available.available.length > 0) {
          // Set default to latest month
          const latest = available.available[available.available.length - 1];
          const yearSelect = document.getElementById('year-select');
          const monthSelect = document.getElementById('month-select');
          
          if (yearSelect) yearSelect.value = latest.year;
          if (monthSelect) monthSelect.value = latest.month;
          
          // Load initial map
          const timeStr = `${latest.year}${String(latest.month).padStart(2, '0')}`;
          await mapManager.loadLayer('hsi', timeStr);
          // Update legend after data loaded
          updateLegendGradient('hsi');
        }
      } catch (error) {
        console.error('Error loading available data:', error);
      }

      // Layer selector
      const layerSelect = document.getElementById('layer-select');
      if (layerSelect) {
        layerSelect.addEventListener('change', (e) => {
          const year = parseInt(document.getElementById('year-select').value);
          const month = parseInt(document.getElementById('month-select').value);
          const timeStr = `${year}${String(month).padStart(2, '0')}`;
          mapManager.loadLayer(e.target.value, timeStr);
          updateLegendTitle(e.target.value);
        });
      }

      // Colormap selector
      const colormapSelect = document.getElementById('colormap-select');
      if (colormapSelect) {
        colormapSelect.addEventListener('change', (e) => {
          mapManager.setColormap(e.target.value);
          updateLegendGradient(mapManager.currentLayer);
        });
      }
      
      // Initialize legend gradient
      setTimeout(() => {
        if (mapManager) {
          updateLegendGradient('hsi');
        }
      }, 100);

      // Year-Month selectors
      const yearSelect = document.getElementById('year-select');
      const monthSelect = document.getElementById('month-select');
      
      function updateMapFromSelectors() {
        if (yearSelect && monthSelect) {
          const year = parseInt(yearSelect.value);
          const month = parseInt(monthSelect.value);
          const timeStr = `${year}${String(month).padStart(2, '0')}`;
          mapManager.loadLayer(mapManager.currentLayer, timeStr).catch(error => {
            console.error('Error loading map:', error);
          });
        }
      }
      
      if (yearSelect) {
        yearSelect.addEventListener('change', updateMapFromSelectors);
      }
      if (monthSelect) {
        monthSelect.addEventListener('change', updateMapFromSelectors);
      }

      function updateLegendTitle(layer) {
        const legendTitle = document.getElementById('legend-title');
        if (legendTitle) {
          const layerNames = {
            'hsi': 'HSI Legend',
            'sst': 'SST Legend (Â°C)',
            'chlor_a': 'Chlorophyll-a Legend (mg/mÂ³)',
            'salinity': 'Salinity Legend (PSU)'
          };
          legendTitle.textContent = layerNames[layer] || 'Legend';
        }
        updateLegendGradient(layer);
      }

      // Helper function to get colormap color
      function getColormapColor(value, colormapName) {
        const colormap = COLORMAPS[colormapName] || COLORMAPS.viridis;
        const colors = colormap.colors;
        
        if (value <= 0) return colors[0];
        if (value >= 1) return colors[colors.length - 1];
        
        const index = value * (colors.length - 1);
        const lower = Math.floor(index);
        const upper = Math.ceil(index);
        const fraction = index - lower;
        
        function interpolateColor(color1, color2, fraction) {
          const hex1 = color1.replace('#', '');
          const hex2 = color2.replace('#', '');
          
          const r1 = parseInt(hex1.substring(0, 2), 16);
          const g1 = parseInt(hex1.substring(2, 4), 16);
          const b1 = parseInt(hex1.substring(4, 6), 16);
          
          const r2 = parseInt(hex2.substring(0, 2), 16);
          const g2 = parseInt(hex2.substring(2, 4), 16);
          const b2 = parseInt(hex2.substring(4, 6), 16);
          
          const r = Math.round(r1 + (r2 - r1) * fraction);
          const g = Math.round(g1 + (g2 - g1) * fraction);
          const b = Math.round(b1 + (b2 - b1) * fraction);
          
          return `#${[r, g, b].map(x => x.toString(16).padStart(2, '0')).join('')}`;
        }
        
        return interpolateColor(colors[lower], colors[upper], fraction);
      }

      function updateLegendGradient(layer) {
        const gradientEl = document.getElementById('legend-gradient');
        const minEl = document.getElementById('legend-min');
        const maxEl = document.getElementById('legend-max');
        const unitEl = document.getElementById('legend-unit');
        const categoriesEl = document.getElementById('legend-categories');
        
        if (!gradientEl) return;
        
        const range = VALUE_RANGES[layer] || VALUE_RANGES.hsi;
        const colormapName = mapManager ? mapManager.currentColormap : 'viridis';
        
        const steps = 100;
        let gradientStops = '';
        for (let i = 0; i <= steps; i++) {
          const value = i / steps;
          const color = getColormapColor(value, colormapName);
          gradientStops += `${color} ${(i / steps) * 100}%, `;
        }
        
        gradientEl.style.background = `linear-gradient(to top, ${gradientStops.slice(0, -2)})`;
        
        let minValue = '', maxValue = '', unit = '';
        const categories = [];
        
        if (layer === 'hsi') {
          minValue = '0.0';
          maxValue = '1.0';
          unit = '(Index 0-1)';
          categories.push(
            { range: '0.75 - 1.0', label: 'Tinggi', color: getColormapColor(0.875, colormapName), meaning: 'Sangat sesuai untuk habitat' },
            { range: '0.45 - 0.75', label: 'Sedang', color: getColormapColor(0.6, colormapName), meaning: 'Cukup sesuai untuk habitat' },
            { range: '0.0 - 0.45', label: 'Rendah', color: getColormapColor(0.225, colormapName), meaning: 'Kurang sesuai untuk habitat' }
          );
        } else if (layer === 'sst') {
          minValue = '25Â°C';
          maxValue = '31Â°C';
          unit = '(Suhu Permukaan Laut)';
          categories.push(
            { range: '27-29Â°C', label: 'Optimal', color: getColormapColor(0.5, colormapName), meaning: 'Suhu optimal untuk habitat' },
            { range: '25-27Â°C', label: 'Dingin', color: getColormapColor(0.25, colormapName), meaning: 'Suhu relatif dingin' },
            { range: '29-31Â°C', label: 'Hangat', color: getColormapColor(0.75, colormapName), meaning: 'Suhu relatif hangat' }
          );
        } else if (layer === 'chlor_a') {
          minValue = '0.1';
          maxValue = '3.0';
          unit = '(mg/mÂ³)';
          categories.push(
            { range: '0.5-2.0', label: 'Normal', color: getColormapColor(0.5, colormapName), meaning: 'Konsentrasi klorofil normal' },
            { range: '0.1-0.5', label: 'Rendah', color: getColormapColor(0.25, colormapName), meaning: 'Konsentrasi klorofil rendah' },
            { range: '2.0-3.0', label: 'Tinggi', color: getColormapColor(0.75, colormapName), meaning: 'Konsentrasi klorofil tinggi' }
          );
        } else if (layer === 'salinity') {
          minValue = '31';
          maxValue = '36';
          unit = '(PSU - Practical Salinity Unit)';
          categories.push(
            { range: '33-34', label: 'Optimal', color: getColormapColor(0.5, colormapName), meaning: 'Salinitas optimal untuk habitat' },
            { range: '31-33', label: 'Rendah', color: getColormapColor(0.25, colormapName), meaning: 'Salinitas relatif rendah' },
            { range: '34-36', label: 'Tinggi', color: getColormapColor(0.75, colormapName), meaning: 'Salinitas relatif tinggi' }
          );
        } else {
          minValue = range.min.toFixed(1);
          maxValue = range.max.toFixed(1);
          unit = '';
        }
        
        if (minEl) minEl.textContent = minValue;
        if (maxEl) maxEl.textContent = maxValue;
        if (unitEl) unitEl.textContent = unit;
        
        if (categoriesEl && categories.length > 0) {
          categoriesEl.innerHTML = categories.map(cat => `
            <div class="flex items-start gap-2 py-1">
              <div class="w-4 h-4 rounded-sm mt-0.5 flex-shrink-0" style="background-color: ${cat.color}"></div>
              <div class="flex-1">
                <div class="text-xs font-medium text-gray-700 dark:text-gray-300">
                  ${cat.label} (${cat.range})
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 text-[10px] leading-tight">
                  ${cat.meaning}
                </div>
              </div>
            </div>
          `).join('');
        }
      }
    });
  </script>
</body>
</html>


